{% extends 'base.html' %}
{% load static %}

{% block head %}
<script src="https://npmcdn.com/imagesloaded@4.1/imagesloaded.pkgd.min.js"></script>
<script src="https://unpkg.com/masonry-layout@4.1/dist/masonry.pkgd.min.js"></script>
<script src="{% static "js/js.js" %}"></script>
{% endblock %}

{% block content %}
<section class="home grid">
	<div class="tags stamp">
		<ul class="h-list">
			{% if whereIAm.0 == 'tag' %}
				<li><a href="/">TODO</a></li>
				{% for tag in tags %}
					<li><a href="/tag/{{tag.slug}}" {% if tag.slug == whereIAm.1 %} class="selected" {% endif %}>{{tag.name}}</a></li>
				{% endfor %}
			{% else %}
				<li><a href="/" class="selected">TODO</a></li>
				{% for tag in tags %}
					<li><a href="/tag/{{tag.slug}}">{{tag.name}}</a></li>
				{% endfor %}
			{% endif %}
		</ul>
	</div>
	<div class="grid-sizer"></div>
	{% for i in photos %}
		<figure class="grid-item" style="display:none;">
			<a href="">
				<img src="{{ i.image.url }}" alt="">
			</a>
		</figure>
	{% endfor %}
</section>
{% endblock %}

{% block scriptjs %}
<script>
	var grid = document.querySelector('.grid');

	var msnry = new Masonry(grid, {
		itemSelector: '.grid-item',
		columnWidth: '.grid-sizer',
		percentPosition: true,
		stamp: '.stamp',
		hiddenStyle: {
			transform: 'translateY(100px)',
      opacity: 0
    },
    visibleStyle: {
      transform: 'translateY(0px)',
      opacity: 1
    }
	});

	function findParent(el, cls) {
		while ((el = el.parentElement) && !el.classList.contains(cls));
		return el;
	}

	imagesLoaded(grid).on('progress', function(instance, image) {
		var el = document.querySelector("img[src='"+image.img.getAttribute('src')+"']");
		var parent = findParent(el, 'grid-item');
		// un-hide item
		parent.style.display = '';
		// layout Masonry after each image loads
		msnry.layout();
	});
</script>
{% endblock %}
